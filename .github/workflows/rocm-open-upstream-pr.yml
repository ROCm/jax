name: ROCm Open Upstream PR
on:
  pull_request:
    types: [ labeled ]
    branches: [ rocm-main ]
jobs:
  open-upstream:
    if: ${{ github.event.label.name == 'open-upstream' }}
    runs-on: ubuntu-latest
    env:
      NEW_BRANCH_NAME: "${{ github.head_ref }}-upstream"
      NEW_PR_TITLE: "[ROCM] ${{ github.event.pull_request.title }}"
    steps:
      - name: Checkout code
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683  # v4.2.2
      - name: Rebase code to main
        run: |
          git checkout -b $NEW_BRANCH_NAME ${{ github.head_ref }}
          git rebase --onto main
          git push origin HEAD
      # TODO: Change the base branch to upstream main once we've tested this out and know it works
      - name: Create a PR to upstream
        run: gh pr create --base rocm/main --head $NEW_BRANCH_NAME --title "$NEW_PR_TITLE" --body "${{ github.event.pull_request.body }}"

